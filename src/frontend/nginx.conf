# Server block configuration for frontend
# This file is placed in /etc/nginx/conf.d/default.conf
# The main nginx.conf from the base image handles global configuration
# Note: pid file location configured in main nginx.conf via command line

server {
    listen       3000;
    server_name  _;
    root         /usr/share/nginx/html;
    index        index.html;

    # Security Headers (per docs/security.md and technical-decisions.md)
    # X-Content-Type-Options: Prevent MIME type sniffing
    add_header X-Content-Type-Options "nosniff" always;
    
    # X-Frame-Options: Prevent clickjacking attacks
    add_header X-Frame-Options "DENY" always;
    
    # X-XSS-Protection: Enable XSS filtering (legacy browsers)
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Strict-Transport-Security: Enforce HTTPS (1 year)
    # Note: Only add in production with HTTPS enabled
    # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Content-Security-Policy: Restrict resource loading
    # Allow same-origin, API calls to backend, and inline styles/scripts from Vite
    # Adjust 'self' and API URL based on environment
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' http://localhost:5000 https://localhost:5000; frame-ancestors 'none';" always;

    # Redirect HTTP to HTTPS in production (uncomment when HTTPS is configured)
    # if ($scheme != "https") {
    #     return 301 https://$host$request_uri;
    # }

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /assets/ {
        expires 7d;
        access_log off;
        add_header Cache-Control "public";
    }

    location /health {
        return 200 'ok';
        add_header Content-Type text/plain;
    }
}
